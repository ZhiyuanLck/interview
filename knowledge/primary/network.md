# 计算机网络

## IP地址

1. IPv4地址空间分类寻址
    - A类：0开头，8位网络号，24位主机
    - B类：10开头，16位网络号，16位主机
    - C类：110开头，24位网络号，8位主机
    - D类：1110开头，组播地址
    - E类：1111开头，保留

1. 子网掩码

    子网掩码是由一台主机或路由器使用的分配位，以确定如何从一台主机对应IP地址获
    得网络和子网信息。子网掩码与对应的IP地址的长度相同，一个IP地址可以与子网掩
    码进行按位与操作，形成用于路由地址的网络/子网标识符（前缀）

1. 可变子网掩码VLSM

    大多数主机、路由器和路由协议支持VLSM，VLSM用于分割一个网络号，使每个子网支
    持不同数量的主机。

1. 子网广播地址

    子网广播地址通过将IPv4地址的网络/子网部分设置为适当值，主机部分所有位设置
    为1而形成。通过子网掩码取反，然后与IP地址进行按位或操作形成。广播地址可用
    于IPv4中，IPv6仅使用组播地址。

1. 无类别域间路由CIRD

    通过CIDR掩码，未经过预定义的任何地址范围可作为一个类的部分，消除了一个IP地
    址中网路和主机号的预定义分隔。

1. 组播地址

    IPv4和IPv6都支持组播寻址。一个IP组播地址标识一组主机接口而不是单个主机接口。
    一个组所覆盖的网络部分成为组的范围。常见范围包括节点本地（同一计算机）、链
    路本地（同一子网）、站点本地和全球。

    当一台主机向一个组发送数据时，使用单播IP地址作为源地址，使用组播IP地址作为
    目的地址，已加入组的所有主机将接收发送到该组的任何数据报。

## 链路层

1. 以太网帧大小

    以太网帧最小为64字节，有效载荷最小为48字节，不够时填充。传统以太网最大帧长
    度是1518字节，包括4字节CRC和14字节头部，剩下的是1500字节的MTU

1. 链路层流量控制

    以太网使用PAUSE消息实现流量控制，由802.3x定义。PAUSE消息包含在MAC控制帧中，
    通过将以太网长度/类型字段值设为0x8808，以及使用MAC控制操作码0x0001来标识，
    如果一个站接收到这种帧，表示建议它减缓发送。PAUSE帧总是被发送到固定的MAC地
    址，且只能在全双工链路上使用。它包含一个保持关闭（hold-off）时间值，表明发
    送方在继续发送之前需要暂停多长时间。

1. 网桥和交换机

    交换机本质是高性能的网桥，网桥或交换机用于连接多个物理的链路层网络组成的站。

1. 生成树协议STP

    STP通过在每个网桥禁用某些端口来工作，这样可以避免拓扑环路。o

1. 无线局域网协议

    IEEE 802.11(Wi-Fi)

1. 点到点协议

    PPP表示点到点协议，是一种子串行链路上传输IP数据包的流行方法。PPP实际上是一
    个协议集合，它支持建立链接的基本方法，链路控制协议LCP，以及一系列网络控制
    NCP协议，在LCP建立了基本链路后，用于为各种协议建立网络层链路。

1. ARP

    地址解析协议ARP提供了一种在IPv4地址和各种网络技术使用的硬件地址之间的映射。
    ARP仅用于IPv4

1. ARP直接交付

    直接交付发生在一个IP数据包被发送到一个具有相同IP前缀的IP地址的情况下。

    1. 每个主机会在自己的ARP缓冲区建立一个ARP列表，表示IP地址和MAC地址之间的对
       应关系
    1. 当源主机要发送数据时，首先检查ARP列表中是否有对应IP地址的目的主机的MAC
       地址，如果有，则直接发送数据，如果没有，就向共享的链路层网段中的所有主
       机发送一个被称为ARP请求的以太网帧，该数据包包括的内容有：源主机IP地址，
       源主机MAC地址，目的主机的IP地址。这也被称为链路层广播。
    1. 当本网络的所有主机收到该ARP数据包时，首先检查数据包中的IP地址是否是自己
       的IP地址，如果不是，则忽略该数据包，如果是，则首先从数据包中取出源主机
       的IP地址和MAC地址写入到ARP列表中，如果已经存在，则覆盖，然后将自己的MAC
       地址写入ARP响应包中，告诉源主机自己是它想要找的MAC地址。
    1. 源主机收到ARP响应包后。将目的主机的IP和MAC地址写入ARP列表，并利用此信息
       发送数据。如果源主机一直没有收到ARP响应数据包，表示ARP查询失败。

## IP

1. IPv4数据报

    20字节基本头部和最多40字节的选项（4位头部长度），IPv4数据包最大为65535字节
    （16位总长度），但主机不需要接收超过576字节的IPv4数据包，超过这个限制会对
    数据报进行分片。

    前4个字节包括，版本字段，头部长度，DS字段，ECN，和总长度；第二个字用于分片，
    包括标识，标志和分片偏移；第三个字包括生存期，协议和头部校验和；之后是源IP
    地址，目的IP地址和选项。

1. IPv6数据报

    IPv6头部大小是固定的40字节，包括版本、DS字段、ECN、流标签、负载长度、下一
    个头部、跳数限制、源IP地址和目的IP地址。IPv6头部不支持分片，分片是通过扩展
    头部完成的。

1. IPv4 vs. IPv6

    [详细区别](https://www.ibm.com/docs/zh/i/7.2?topic=6-comparison-ipv4-ipv6)
    - IPv4地址为32位，IPv6地址为128位，IPv6支持更大的寻址空间
    - IPv4地址用点来分割字段，IPv6地址用冒号来分割字段
    - IPv4头部大小在20-60字节，IPv6头部中没有IP报头选项，头部大小为 40字节，但
      IPv6通过扩展头部实现了更多选项
    - IPv4最小MTU为576字节，IPv4为1280字节
    - IPv6移除了头部校验和
    - IPv4支持VLSM，IPv6不支持VLSM而是使用类似CIDR的分层结构
    - IPv4使用ARP将IP地址映射到MAC地址，IPv6使用ICMPv6将这些功能嵌入到IP本身作
      为无状态自动配置和邻节点发现算法的一部分。
    - 分片：IPv4中如果一个信息包对于要传送它的下一链路来说太大，那么可由发送方
      （主机或路由器）对其分段。对于 IPv6，只能在源节点进行分段，且只能在目标
      节点完成重新装配。使用分段扩展报头。

1. 转发表

    转发表每个条目包含目的地、掩码、下一跳和接口。目的地用于与一个掩码操作的结
    果相匹配。

1. IP转发

    取出数据报中的目的IP地址，在转发表中执行最长前缀匹配算法，即搜索所有与目的
    IP地址进行掩码操作后与转发条目目的地相等的条目，选择最匹配的条目（掩码中有
    多少位设置为1，1的数量越多匹配度越高），将其下一跳字段作为转发数据报的下一
    跳IP地址。

## TCP

1. TCP粘包

    指发送放发送的若干包数据到达接收方时粘成了一个包，从接收缓冲区来看，后一包
    数据的头紧接着前一包数据的尾。出现粘包的原因可能是多方面的：
    1. 发送方使用了Nagle算法，将多次间隔较小、数据量较小的数据合并成一个数据量
       大的数据块，然后进行封包。解决方法，使用TCP_NODELAY选项来关闭算法。
    1. 接收方收到数据包存入缓存的速度大于应用程序从缓存中读取数据包的速度，多
       个包就会被缓存。接收方无法解决这个问题

    设计一个带包头的应用层报文结构，包头定长，以特定标志开头，里面带有负载长度。

## HTTP

1. HTTP各个版本的区别

    1. HTTP/0.9，HTTP最早的版本，只有一种请求方法GET，不支持，服务器只能响应
       HTML格式的数据。具有无状态性，每个事务独立处理，事务结束时就释放这个连
       接。
    1. HTTP/1.0，第一个在通讯中制定版本号的HTTP协议版本
        - 支持请求头与响应头，每个通信必须包含头部
        - 增加了POST, PUT, HEAD, DELETE, LINK, UNLINK请求方式
        - 通过Content-Type字段可以发送和响应更多格式的数据
        - 短连接，每次请求建立一个TCP连接，响应后立马断开
    1. HTTP/1.1
        - 增加了OPTION, TRACE, CONNET请求方法
        - 持久连接，建立1次TCP连接后进行多次请求和响应的交互
        - 管线化，从前发送请求后需要等待收到响应后才能发送下一个请求，管线化使
          得不用等待响应也可以直接发送下一个请求
        - 分块传输编码，将实体主体分成多个部分，每一块用十六进制来标记块的大小，
          由接收的客户端解码。能让浏览器逐步显示页面
        - 缓存控制
        - 内容协商，包括语言，编码或类型
        - Host字段，识别同一IP地址下的多个主机
        - 字节范围请求，支持传送内容的一部分，通过Content-Range实现，如果相应
          地返回了对象请求范围的内容，则相应码为206 Partial Content
    1. HTTP/2.0
        - 二进制分帧，在不改动HTTP语义的情况下改进传输性能，实现低延迟和高吞吐
          量。首部信息被封装到Headers帧，body被封装到Data帧，采用二进制格式的
          编码。
        - 多路复用，并行处理多个请求
        - 随时复位，通过RST_STREAM可以方便的停止一个信息传输，启动新的信息
        - 压缩头部
        - 请求优先级
        - server push, 服务器可以主动推送数据
